# MUY √öNCOS - GU√çA DE MIGRACI√ìN DE SNIPPETS\n\nDocumento vivo que rastrea la migraci√≥n progresiva desde **Code Snippets** hacia archivos modulares CSS/JS/PHP en el tema hijo `generatepress-child`.\n\n---\n\n## üìä SECCI√ìN 0: ESTADO DE MIGRACI√ìN\n\n### Tabla de Progreso (Actualizado: 21/02/2026)\n\n| Snippet Original | Tipo | Estado | Archivo Destino | Tama√±o | Notas |\n|---|---|---|---|---|---|\n| **GEOLOCALIZACI√ìN & MULTI-PA√çS** |  |  |  |  |  |\n| Auto-detecci√≥n de Pa√≠s por Dominio | PHP | ‚úÖ Migrado | `functions.php` | ~1.2 KB | Hook `template_redirect`, establece `billing_country` |\n| Shortcode Pa√≠s de Facturaci√≥n | PHP | ‚úÖ Migrado | `functions.php` | ~0.5 KB | `[mi_pais_facturacion]` |\n| Funciones Auxiliares Multi-Pa√≠s (CORE) | PHP | ‚úÖ Migrado | `functions.php` | ~2.1 KB | `muyu_get_countries_data()`, `muyu_clean_uri()`, etc. |\n| Selector de Pa√≠s en Header | PHP+CSS+JS | ‚úÖ Migrado | `functions.php` + `css/components/header.css` + `js/mu-ui-scripts.js` | ~8.5 KB | Dropdown con banderas, ya exist√≠a |\n| **Modal de Sugerencia de Pa√≠s** | **PHP+CSS+JS** | **‚úÖ Migrado** | **`functions.php` + `css/components/country-modal.css` + `js/country-modal.js`** | **~7.2 KB** | **Geolocalizaci√≥n WC, cookie 1 a√±o, multi-idioma** |\n| **CHECKOUT** |  |  |  |  |  |\n| Campos Checkout Optimizados | PHP | ‚úÖ Migrado | `functions.php` | ~4.5 KB | L√≥gica condicional f√≠sico/digital |\n| Validaci√≥n Checkout | PHP | ‚úÖ Migrado | `functions.php` | ~1.8 KB | `woocommerce_checkout_process` |\n| AJAX Check Email | PHP | ‚úÖ Migrado | `functions.php` | ~0.8 KB | `wc_ajax_mu_check_email` |\n| Estilos Checkout | CSS | ‚úÖ Migrado | `css/checkout.css` | 12.3 KB | Variables GP, mobile-first |\n| L√≥gica Checkout (WhatsApp, toggle) | JS | ‚úÖ Migrado | `js/checkout.js` | 8.7 KB | libphonenumber.js, validaciones |\n| **MODAL AUTH** |  |  |  |  |  |\n| HTML Modal Auth | PHP | ‚úÖ Migrado | `functions.php` | ~3.2 KB | `wp_footer`, estructura HTML |\n| WC-AJAX Handlers (login/register) | PHP | ‚úÖ Migrado | `functions.php` | ~2.1 KB | 4 endpoints `wc_ajax_*` |\n| Estilos Modal Auth | CSS | ‚úÖ Migrado | `css/components/modal-auth.css` | 9.8 KB | Animaciones, responsive |\n| L√≥gica Modal Auth | JS | ‚úÖ Migrado | `js/modal-auth.js` | 6.5 KB | Step navigation, AJAX calls |\n| **HEADER** |  |  |  |  |  |\n| Iconos Header | PHP | ‚úÖ Migrado | `functions.php` | ~2.8 KB | `mu_header_icons()`, hook `generate_after_primary_menu` |\n| Estilos Header | CSS | ‚úÖ Migrado | `css/components/header.css` | 8.2 KB | `.mu-header-icons`, `.mu-account-dropdown` |\n| L√≥gica Header (dropdowns) | JS | ‚úÖ Migrado | `js/header.js` | 3.1 KB | Dropdown account, sticky behavior |\n| **FOOTER** |  |  |  |  |  |\n| Estructura Footer Custom | PHP | ‚úÖ Migrado | `functions.php` | ~3.5 KB | `muyunicos_custom_footer_structure()` |\n| Estilos Footer | CSS | ‚úÖ Migrado | `css/components/footer.css` | 11.7 KB | Grid, accordion mobile, trust badge |\n| L√≥gica Footer (accordions) | JS | ‚úÖ Migrado | `js/footer.js` | 1.9 KB | Accordions mobile |\n| **CART** |  |  |  |  |  |\n| Estilos Carrito | CSS | ‚úÖ Migrado | `css/cart.css` | 7.4 KB | Tabla responsive, badges |\n| L√≥gica Carrito | JS | ‚úÖ Migrado | `js/cart.js` | 4.2 KB | Update quantities, remove items |\n| **OTROS** |  |  |  |  |  |\n| Repositorio de Iconos SVG | PHP | ‚úÖ Migrado | `functions.php` | ~1.5 KB | `mu_get_icon()`, 10+ iconos |\n| Bot√≥n Compartir (Share) | PHP+CSS+JS | ‚úÖ Migrado | `functions.php` + `css/components/share-button.css` + `js/share-button.js` | ~4.5 KB | Shortcode `[dcms_share]`, Native Share API + fallback clipboard |\n| Bot√≥n Flotante WhatsApp | PHP+CSS | ‚úÖ Migrado | `functions.php` + `style.css` | ~1.2 KB | `wp_footer` hook |\n| Formulario B√∫squeda Custom | PHP+CSS | ‚úÖ Migrado | `functions.php` + `style.css` | ~2.1 KB | `get_product_search_form` filter |\n| Add Multiple Products to Cart | PHP | ‚úÖ Migrado | `functions.php` | ~0.9 KB | `?add-multiple=1,2,3` |\n| BACS Replace NUMERODEPEDIDO | PHP | ‚úÖ Migrado | `functions.php` | ~1.1 KB | Email + Thank you page |\n| Move Category Description | PHP | ‚úÖ Migrado | `functions.php` | ~0.4 KB | `woocommerce_after_shop_loop` |\n| Google Site Kit Canonical | PHP | ‚úÖ Migrado | `functions.php` | ~0.3 KB | Filter `googlesitekit_canonical_home_url` |\n| **RESTRICCI√ìN DIGITAL** |  |  |  |  |  |\n| Sistema de Restricci√≥n Digital v2.2 | PHP (Clase) | ‚úÖ Migrado/Refactorizado | `functions.php` | ~18.5 KB | `MUYU_Digital_Restriction_System`, optimizado uso multi-pa√≠s core |\n| **HOME** |  |  |  |  |  |\n| Estilos Home | CSS | ‚úÖ Migrado | `css/home.css` | 5.8 KB | Hero, featured products |\n| **SHOP** |  |  |  |  |  |\n| Estilos Shop | CSS | ‚úÖ Migrado | `css/shop.css` | 6.2 KB | Grid productos, filtros |\n| **PRODUCT** |  |  |  |  |  |\n| Estilos Producto | CSS | ‚úÖ Migrado | `css/product.css` | 9.1 KB | Gallery, variations, tabs |\n\n### Estad√≠sticas\n\n- **Total Snippets Migrados**: 40+\n- **Total CSS Modularizado**: ~85 KB\n- **Total JS Modularizado**: ~31 KB\n- **Total PHP en functions.php**: ~62 KB (incluyendo clase restricci√≥n digital)\n- **√öltima Actualizaci√≥n**: 21 de febrero de 2026\n\n---\n\n## üõ†Ô∏è SECCI√ìN 1: PRINCIPIOS DE MIGRACI√ìN\n\n### 1.1 Filosof√≠a General\n\n1. **Anti-Duplicaci√≥n**: Antes de escribir CSS, verificar si GeneratePress ya provee el estilo en `assets/css/main.min.css`\n2. **Variables First**: Usar las variables CSS existentes en `style.css`\n3. **Performance**: Archivos cacheables > estilos inline\n4. **Nomenclatura**: Prefijo `.mu-*` + BEM cuando corresponda\n5. **PHP Robusto**: Envolver funciones en `if ( !function_exists() )`\n\n### 1.2 Estructura de Archivos\n\n```\nmuyunicos/  (= generatepress-child)\n‚îú‚îÄ‚îÄ style.css                  # Variables CSS + base del child theme\n‚îú‚îÄ‚îÄ functions.php              # Enqueue system + funciones PHP\n‚îú‚îÄ‚îÄ MIGRATION-GUIDE.md         # Este archivo (estado de migraci√≥n)\n‚îú‚îÄ‚îÄ css/\n‚îÇ   ‚îú‚îÄ‚îÄ components/             # Componentes reutilizables\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.css\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ footer.css\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modal-auth.css\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ country-modal.css       # NUEVO: Modal sugerencia de pa√≠s\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ share-button.css        # Bot√≥n compartir nativo\n‚îÇ   ‚îú‚îÄ‚îÄ cart.css                # P√°gina carrito\n‚îÇ   ‚îú‚îÄ‚îÄ checkout.css            # P√°gina checkout\n‚îÇ   ‚îú‚îÄ‚îÄ home.css                # Home page\n‚îÇ   ‚îú‚îÄ‚îÄ shop.css                # Shop/Cat/Tag\n‚îÇ   ‚îî‚îÄ‚îÄ product.css             # Single product\n‚îú‚îÄ‚îÄ js/\n‚îÇ   ‚îú‚îÄ‚îÄ header.js\n‚îÇ   ‚îú‚îÄ‚îÄ footer.js\n‚îÇ   ‚îú‚îÄ‚îÄ modal-auth.js\n‚îÇ   ‚îú‚îÄ‚îÄ country-modal.js        # NUEVO: L√≥gica del modal de pa√≠s\n‚îÇ   ‚îú‚îÄ‚îÄ share-button.js         # L√≥gica Native Share API\n‚îÇ   ‚îú‚îÄ‚îÄ cart.js\n‚îÇ   ‚îú‚îÄ‚îÄ checkout.js\n‚îÇ   ‚îî‚îÄ‚îÄ mu-ui-scripts.js       # Country selector + WPLingua toggle\n‚îî‚îÄ‚îÄ assets/\n    ‚îî‚îÄ‚îÄ css/\n        ‚îî‚îÄ‚îÄ main.min.css        # READ-ONLY: GeneratePress parent theme\n```\n\n---\n\n## üìù SECCI√ìN 2: PROTOCOLO PASO A PASO\n\n### Step 0: Anti-Duplicaci√≥n Check (OBLIGATORIO)\n\n**Antes de migrar cualquier snippet**, verificar:\n\n```bash\n# En terminal, desde la ra√≠z del tema:\ngrep -r \"selector-que-quiero-usar\" assets/css/main.min.css\n```\n\nSi GeneratePress ya provee el estilo:\n- **Opci√≥n A**: Usar el estilo del parent tal cual (ideal)\n- **Opci√≥n B**: Si necesitas sobreescribirlo, agregar comentario:\n  ```css\n  /* override GP: [raz√≥n espec√≠fica] */\n  .selector { ... }\n  ```\n\n### Step 1: Identificar Tipo de Snippet\n\n- **Global/Componente**: Va a `css/components/` o directamente en `functions.php`\n- **P√°gina espec√≠fica**: Va a `css/[nombre-pagina].css` con conditional enqueue\n- **PHP puro**: Directamente a `functions.php` con docblock apropiado\n\n### Step 2: Refactorizar C√≥digo\n\n#### CSS:\n```css\n/* Antes (snippet inline) */\n.mi-clase {\n    color: #2B9FCF;  /* üö´ Hardcoded */\n    padding: 20px;\n}\n\n/* Despu√©s (modular) */\n.mu-mi-clase {\n    color: var(--primario);  /* ‚úÖ Variable */\n    padding: var(--mu-space-md);\n}\n```\n\n#### PHP:\n```php\n// Antes (snippet sin protecci√≥n)\nfunction mi_funcion() { ... }\n\n// Despu√©s (robusto)\nif ( !function_exists('mu_mi_funcion') ) {\n    /**\n     * Descripci√≥n clara de la funci√≥n\n     * @param string $param Descripci√≥n del par√°metro\n     * @return mixed Descripci√≥n del retorno\n     */\n    function mu_mi_funcion($param) {\n        // L√≥gica\n    }\n}\n```\n\n#### JavaScript:\n```javascript\n// Antes (snippet inline)\njQuery(function($) {\n    $('.clase').click(...);\n});\n\n// Despu√©s (IIFE + strict mode)\n(function() {\n    'use strict';\n    \n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n    \n    function init() {\n        // L√≥gica\n    }\n})();\n```\n\n### Step 3: Actualizar `functions.php` (si aplica)\n\nSi creaste un archivo CSS/JS nuevo:\n\n```php\nfunction mu_enqueue_assets() {\n    // ... c√≥digo existente ...\n    \n    // NUEVO: Enqueue condicional\n    if ( is_nueva_condicion() ) {\n        wp_enqueue_style(\n            'mu-nuevo-archivo',\n            get_stylesheet_directory_uri() . '/css/nuevo-archivo.css',\n            array('mu-base'),  // Dependencia\n            wp_get_theme()->get('Version')\n        );\n    }\n}\n```\n\n### Step 4: Actualizar ESTA GU√çA\n\nEditar **Secci√≥n 0** (arriba):\n1. Cambiar estado de \"‚ùå Pendiente\" a \"‚úÖ Migrado\"\n2. Completar columna \"Archivo Destino\"\n3. Agregar tama√±o del archivo (usar `ls -lh archivo.css`)\n4. Actualizar fecha de \"√öltima Actualizaci√≥n\"\n\n---\n\n## üéØ SECCI√ìN 3: CASOS ESPECIALES\n\n### 3.1 Funciones Multi-Pa√≠s (Geolocalizaci√≥n)\n\n**Dependencias**: Las funciones auxiliares multi-pa√≠s son **CORE** y deben cargarse primero:\n\n```php\n// ‚úÖ CORRECTO: Funciones auxiliares primero\nif ( !function_exists('muyu_get_countries_data') ) { ... }\nif ( !function_exists('muyu_clean_uri') ) { ... }\n\n// Luego, funciones que las usan:\nif ( !function_exists('mu_auto_detect_country_by_domain') ) {\n    function mu_auto_detect_country_by_domain() {\n        $countries = muyu_get_countries_data();  // Usa helper\n        // ...\n    }\n}\n```\n\n**Funciones auxiliares disponibles**:\n- `muyu_get_main_domain()` - Dominio principal cacheado\n- `muyu_country_language_prefix($code)` - Prefijo de idioma ('/pt', '/en')\n- `muyu_get_countries_data()` - Array completo de pa√≠ses\n- `muyu_get_current_country_from_subdomain()` - Pa√≠s actual por subdominio\n- `muyu_clean_uri($prefix, $uri)` - Normaliza URIs con prefijo de idioma\n- `muyu_country_modal_text($code, $type)` - Textos localizados para modal\n\n### 3.2 Iconos SVG\n\n**Nunca** insertar SVG inline. Usar siempre:\n\n```php\n// ‚úÖ CORRECTO\necho mu_get_icon('instagram');\n\n// ‚ùå INCORRECTO\necho '<svg>...</svg>';  // Duplicaci√≥n, no cacheable\n```\n\n**Iconos disponibles**:\n`arrow`, `search`, `close`, `share`, `check`, `instagram`, `facebook`, `pinterest`, `tiktok`, `youtube`\n\n### 3.3 WC-AJAX vs wp_ajax\n\n**Preferir WC-AJAX** para operaciones de WooCommerce:\n\n```php\n// ‚úÖ CORRECTO (WC-AJAX, m√°s r√°pido)\nadd_action('wc_ajax_mu_check_email', 'mi_funcion');\n\n// ‚ùå EVITAR (wp_ajax, m√°s lento)\nadd_action('wp_ajax_mi_accion', 'mi_funcion');\nadd_action('wp_ajax_nopriv_mi_accion', 'mi_funcion');\n```\n\n### 3.4 Restricci√≥n de Contenido Digital\n\nLa clase `MUYU_Digital_Restriction_System` es un **singleton** que gestiona:\n- √çndices de productos digitales\n- Redirecciones autom√°ticas\n- Filtrado de queries\n- Ocultaci√≥n de variaciones f√≠sicas\n\n**No modificar directamente**. Usar funciones helper:\n```php\nif ( muyu_is_restricted_user() ) {\n    // L√≥gica para subdominios (solo digital)\n}\n\n$country = muyu_get_user_country_code();  // 'AR', 'MX', 'BR', etc.\n```\n\n### 3.5 Modal de Sugerencia de Pa√≠s\n\n**Nuevo componente migrado** (21/02/2026):\n\n- **Funci√≥n**: Detecta el pa√≠s del usuario mediante `wc_get_customer_geolocation()` y sugiere el sitio correcto\n- **Cookie**: `muyu_stay_here` - Persiste 1 a√±o en `.muyunicos.com`\n- **Multi-idioma**: Usa `muyu_country_modal_text()` para textos localizados (es/pt/en)\n- **Enqueue condicional**: Solo se carga si debe mostrarse (optimizaci√≥n)\n- **Archivos**:\n  - `css/components/country-modal.css` - Estilos con variables CSS\n  - `js/country-modal.js` - L√≥gica IIFE + event listeners\n  - `functions.php` - Funciones `mu_should_show_country_modal()` y `mu_country_modal_html()`\n\n**Ejemplo de uso**:\n```php\n// El modal se renderiza autom√°ticamente en wp_footer\n// No requiere shortcode ni invocaci√≥n manual\n// Solo se muestra si el usuario est√° en dominio incorrecto\n```\n\n---\n\n## ‚úÖ SECCI√ìN 4: CHECKLIST DE MIGRACI√ìN\n\nAntes de marcar un snippet como \"Migrado\":\n\n- [ ] C√≥digo refactorizado (variables, nomenclatura, comentarios)\n- [ ] Anti-duplicaci√≥n verificada (Step 0)\n- [ ] Archivo creado/actualizado en ubicaci√≥n correcta\n- [ ] `functions.php` actualizado (enqueue si aplica)\n- [ ] Probado en frontend (no rompe layout existente)\n- [ ] Probado en mobile (responsive)\n- [ ] Tabla de Secci√≥n 0 actualizada\n- [ ] Commit con mensaje descriptivo (`feat:`, `fix:`, `refactor:`)\n\n---\n\n## üîó SECCI√ìN 5: RECURSOS\n\n### Variables CSS Disponibles (style.css)\n\n```css\n--primario: #2B9FCF;\n--secundario: #FFD77A;\n--texto: #277292;\n--exito: #a3ffbc;\n--mu-space-xs: 5px;\n--mu-space-sm: 10px;\n--mu-space-md: 20px;\n--mu-space-lg: 40px;\n--mu-space-xl: 40px;\n--mu-radius-sm: 6px;\n--mu-radius: 12px;\n--mu-radius-md: 16px;\n--mu-radius-lg: 20px;\n--mu-radius-xl: 32px;\n--mu-shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);\n--mu-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n--mu-shadow-md: 0 8px 16px rgba(0, 0, 0, 0.15);\n--mu-shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);\n--mu-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n--mu-transition-fast: all 0.2s ease;\n```\n\n### Breakpoints Mobile-First\n\n```css\n/* Mobile: 0-768px (default) */\n.mu-clase { ... }\n\n/* Tablet y superior: 769px+ */\n@media (min-width: 769px) {\n    .mu-clase { ... }\n}\n```\n\n### Hooks GeneratePress √ötiles\n\n- `generate_header` (priority 1-20)\n- `generate_after_primary_menu`\n- `generate_before_footer`\n- `wp_footer` (priority 5-100)\n\n---\n\n## üìå SECCI√ìN 6: PR TEMPLATE\n\nCuando hagas un Pull Request de migraci√≥n, usar este template:\n\n```markdown\n## Migraci√≥n: [Nombre del Snippet]\n\n### Cambios\n- ‚úÖ Migrado snippet \"[nombre]\" a `[archivo destino]`\n- ‚ôªÔ∏è Refactorizado: [detalle de mejoras]\n- üìÑ Actualizado MIGRATION-GUIDE.md\n\n### Archivos Modificados\n- `functions.php` (+XXX l√≠neas)\n- `css/[archivo].css` (nuevo, XX KB)\n- `js/[archivo].js` (nuevo, XX KB)\n\n### Testing\n- [ ] Desktop (Chrome, Firefox)\n- [ ] Mobile (Responsive)\n- [ ] No rompe layout existente\n- [ ] Variables CSS usadas correctamente\n\n### Screenshots\n(Opcional: adjuntar capturas before/after)\n```\n\n---\n\n**√öltima Revisi√≥n**: 21 de febrero de 2026  \n**Mantenedor**: Jonatan Pintos  \n**Repositorio**: [github.com/muyunicos/muyunicos](https://github.com/muyunicos/muyunicos)\n