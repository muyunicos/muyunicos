/**\n * Lógica Botón Compartir Nativo\n * Implementa Native Share API con fallback al portapapeles\n * Migrado desde Code Snippets\n */\n(function() {\n    'use strict';\n\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initShareButtons);\n    } else {\n        initShareButtons();\n    }\n\n    function initShareButtons() {\n        const shareBtns = document.querySelectorAll('.dcms-share-btn');\n        \n        if (!shareBtns.length) return;\n        \n        // Default check icon in case wp_localize_script fails\n        const checkIcon = (typeof muShareVars !== 'undefined' && muShareVars.checkIcon) \n            ? muShareVars.checkIcon \n            : '<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#27ae60\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"></polyline></svg>';\n\n        shareBtns.forEach(btn => {\n            btn.addEventListener('click', async (e) => {\n                e.preventDefault();\n                \n                const descriptionMeta = document.querySelector('meta[name=\"description\"]');\n                \n                const shareData = {\n                    title: document.title,\n                    text: descriptionMeta ? descriptionMeta.content : document.title,\n                    url: window.location.href\n                };\n\n                // 1. INTENTO NATIVO (Móvil / Tablet / Edge)\n                if (navigator.share) {\n                    try {\n                        await navigator.share(shareData);\n                    } catch (err) {\n                        // Si el usuario cancela, no hacemos fallback\n                        if (err.name !== 'AbortError') {\n                            copyToClipboard(shareData.url, btn, checkIcon);\n                        }\n                    }\n                } else {\n                    // 2. FALLBACK ESCRITORIO (Portapapeles)\n                    copyToClipboard(shareData.url, btn, checkIcon);\n                }\n            });\n        });\n    }\n\n    function copyToClipboard(text, btn, checkIcon) {\n        if (!navigator.clipboard) {\n            fallbackCopyTextToClipboard(text, btn, checkIcon);\n            return;\n        }\n        \n        navigator.clipboard.writeText(text).then(function() {\n            showFeedback(btn, checkIcon);\n        }).catch(function(err) {\n            console.error('Error al copiar: ', err);\n        });\n    }\n\n    function fallbackCopyTextToClipboard(text, btn, checkIcon) {\n        const textArea = document.createElement(\"textarea\");\n        textArea.value = text;\n        \n        // Evitar scrolling al focus\n        textArea.style.top = \"0\";\n        textArea.style.left = \"0\";\n        textArea.style.position = \"fixed\";\n        \n        document.body.appendChild(textArea);\n        textArea.focus();\n        textArea.select();\n        \n        try {\n            document.execCommand('copy');\n            showFeedback(btn, checkIcon);\n        } catch (err) {\n            console.error('Fallback error', err);\n        }\n        \n        document.body.removeChild(textArea);\n    }\n\n    function showFeedback(btn, checkIcon) {\n        // Guardar icono original si no está guardado\n        if (!btn.dataset.originalHtml) {\n            btn.dataset.originalHtml = btn.innerHTML;\n        }\n        \n        // Cambiar a Check \n        btn.innerHTML = checkIcon;\n        btn.classList.add('copied-success');\n\n        // Crear Tooltip flotante si no existe\n        let tooltip = btn.parentNode.querySelector('.dcms-share-tooltip');\n        if (!tooltip) {\n            tooltip = document.createElement('span');\n            tooltip.className = 'dcms-share-tooltip';\n            tooltip.textContent = '¡Enlace copiado!';\n            \n            // Posicionar tooltip cerca del botón\n            btn.parentNode.style.position = 'relative';\n            btn.parentNode.insertBefore(tooltip, btn.nextSibling);\n        }\n\n        // Limpiar timeout anterior si existe\n        if (btn.feedbackTimeout) {\n            clearTimeout(btn.feedbackTimeout);\n        }\n\n        // Restaurar después de 2s\n        btn.feedbackTimeout = setTimeout(() => {\n            if (btn.dataset.originalHtml) {\n                btn.innerHTML = btn.dataset.originalHtml;\n            }\n            btn.classList.remove('copied-success');\n            if (tooltip && tooltip.parentNode) {\n                tooltip.parentNode.removeChild(tooltip);\n            }\n        }, 2000);\n    }\n})();